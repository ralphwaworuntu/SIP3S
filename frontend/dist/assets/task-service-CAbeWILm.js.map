{"version":3,"file":"task-service-CAbeWILm.js","sources":["../../src/services/task-service.ts"],"sourcesContent":["import apiClient from \"@/services/http\";\nimport type { Task, TaskStatus } from \"@/types/task\";\nimport { mockTasks } from \"@/utils/mock-data\";\n\nconst STORAGE_KEY = \"sip3s.tasks\";\n\nconst cloneTasks = (tasks: Task[]): Task[] => tasks.map((task) => ({ ...task, assignedTo: [...task.assignedTo] }));\n\nconst readLocalTasks = (): Task[] => {\n  if (typeof window === \"undefined\") {\n    return cloneTasks(mockTasks);\n  }\n  try {\n    const raw = window.localStorage.getItem(STORAGE_KEY);\n    if (!raw) {\n      window.localStorage.setItem(STORAGE_KEY, JSON.stringify(mockTasks));\n      return cloneTasks(mockTasks);\n    }\n    const parsed = JSON.parse(raw) as Task[] | null;\n    if (!parsed || !Array.isArray(parsed)) {\n      return cloneTasks(mockTasks);\n    }\n    return cloneTasks(parsed);\n  } catch (error) {\n    console.warn(\"Gagal membaca cache tugas\", error);\n    return cloneTasks(mockTasks);\n  }\n};\n\nconst persistLocalTasks = (tasks: Task[]) => {\n  if (typeof window === \"undefined\") return;\n  try {\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));\n  } catch (error) {\n    console.warn(\"Gagal menyimpan cache tugas\", error);\n  }\n};\n\nclass TaskService {\n  async list(): Promise<Task[]> {\n    try {\n      const { data } = await apiClient.get<Task[]>(\"/tasks\");\n      persistLocalTasks(data);\n      return data;\n    } catch (error) {\n      return readLocalTasks();\n    }\n  }\n\n  async assign(task: Task): Promise<Task> {\n    try {\n      const { data } = await apiClient.post<Task>(\"/tasks\", task);\n      const current = readLocalTasks();\n      const next = [data, ...current.filter((item) => item.id !== data.id)];\n      persistLocalTasks(next);\n      return data;\n    } catch (error) {\n      const fallback = { ...task, updatedAt: new Date().toISOString() };\n      const current = readLocalTasks();\n      const next = [fallback, ...current.filter((item) => item.id !== fallback.id)];\n      persistLocalTasks(next);\n      return fallback;\n    }\n  }\n\n  async updateStatus(id: string, status: TaskStatus): Promise<Task | null> {\n    try {\n      const { data } = await apiClient.patch<Task>(`/tasks/${id}/status`, { status });\n      const current = readLocalTasks();\n      const next = current.map((item) => (item.id === data.id ? data : item));\n      persistLocalTasks(next);\n      return data;\n    } catch (error) {\n      const current = readLocalTasks();\n      const index = current.findIndex((item) => item.id === id);\n      if (index === -1) {\n        return null;\n      }\n      const updated: Task = { ...current[index], status, updatedAt: new Date().toISOString() };\n      const next = current.map((item) => (item.id === id ? updated : item));\n      persistLocalTasks(next);\n      return updated;\n    }\n  }\n}\n\nexport const taskService = new TaskService();\r\n"],"names":["STORAGE_KEY","cloneTasks","tasks","task","readLocalTasks","mockTasks","raw","parsed","error","persistLocalTasks","TaskService","data","apiClient","current","next","item","fallback","id","status","index","updated","taskService"],"mappings":"oFAIA,MAAMA,EAAc,cAEdC,EAAcC,GAA0BA,EAAM,IAAKC,IAAU,CAAE,GAAGA,EAAM,WAAY,CAAC,GAAGA,EAAK,UAAU,GAAI,EAE3GC,EAAiB,IAAc,CACnC,GAAI,OAAO,OAAW,IACpB,OAAOH,EAAWI,CAAS,EAE7B,GAAI,CACF,MAAMC,EAAM,OAAO,aAAa,QAAQN,CAAW,EACnD,GAAI,CAACM,EACH,cAAO,aAAa,QAAQN,EAAa,KAAK,UAAUK,CAAS,CAAC,EAC3DJ,EAAWI,CAAS,EAE7B,MAAME,EAAS,KAAK,MAAMD,CAAG,EAC7B,MAAI,CAACC,GAAU,CAAC,MAAM,QAAQA,CAAM,EAC3BN,EAAWI,CAAS,EAEtBJ,EAAWM,CAAM,CAC1B,OAASC,EAAO,CACd,eAAQ,KAAK,4BAA6BA,CAAK,EACxCP,EAAWI,CAAS,CAC7B,CACF,EAEMI,EAAqBP,GAAkB,CAC3C,GAAI,SAAO,OAAW,KACtB,GAAI,CACF,OAAO,aAAa,QAAQF,EAAa,KAAK,UAAUE,CAAK,CAAC,CAChE,OAASM,EAAO,CACd,QAAQ,KAAK,8BAA+BA,CAAK,CACnD,CACF,EAEA,MAAME,CAAY,CAChB,MAAM,MAAwB,CAC5B,GAAI,CACF,KAAM,CAAE,KAAAC,CAAA,EAAS,MAAMC,EAAU,IAAY,QAAQ,EACrD,OAAAH,EAAkBE,CAAI,EACfA,CACT,MAAgB,CACd,OAAOP,EAAA,CACT,CACF,CAEA,MAAM,OAAOD,EAA2B,CACtC,GAAI,CACF,KAAM,CAAE,KAAAQ,CAAA,EAAS,MAAMC,EAAU,KAAW,SAAUT,CAAI,EACpDU,EAAUT,EAAA,EACVU,EAAO,CAACH,EAAM,GAAGE,EAAQ,OAAQE,GAASA,EAAK,KAAOJ,EAAK,EAAE,CAAC,EACpE,OAAAF,EAAkBK,CAAI,EACfH,CACT,MAAgB,CACd,MAAMK,EAAW,CAAE,GAAGb,EAAM,UAAW,IAAI,KAAA,EAAO,aAAY,EACxDU,EAAUT,EAAA,EACVU,EAAO,CAACE,EAAU,GAAGH,EAAQ,OAAQE,GAASA,EAAK,KAAOC,EAAS,EAAE,CAAC,EAC5E,OAAAP,EAAkBK,CAAI,EACfE,CACT,CACF,CAEA,MAAM,aAAaC,EAAYC,EAA0C,CACvE,GAAI,CACF,KAAM,CAAE,KAAAP,CAAA,EAAS,MAAMC,EAAU,MAAY,UAAUK,CAAE,UAAW,CAAE,OAAAC,CAAA,CAAQ,EAExEJ,EADUV,EAAA,EACK,IAAKW,GAAUA,EAAK,KAAOJ,EAAK,GAAKA,EAAOI,CAAK,EACtE,OAAAN,EAAkBK,CAAI,EACfH,CACT,MAAgB,CACd,MAAME,EAAUT,EAAA,EACVe,EAAQN,EAAQ,UAAWE,GAASA,EAAK,KAAOE,CAAE,EACxD,GAAIE,IAAU,GACZ,OAAO,KAET,MAAMC,EAAgB,CAAE,GAAGP,EAAQM,CAAK,EAAG,OAAAD,EAAQ,UAAW,IAAI,KAAA,EAAO,YAAA,CAAY,EAC/EJ,EAAOD,EAAQ,IAAKE,GAAUA,EAAK,KAAOE,EAAKG,EAAUL,CAAK,EACpE,OAAAN,EAAkBK,CAAI,EACfM,CACT,CACF,CACF,CAEO,MAAMC,EAAc,IAAIX"}