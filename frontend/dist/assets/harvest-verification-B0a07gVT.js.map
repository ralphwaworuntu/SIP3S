{"version":3,"file":"harvest-verification-B0a07gVT.js","sources":["../../src/pages/dashboard/bhabinkamtibmas/harvest-verification.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport {\n  ArrowsClockwise,\n  Camera,\n  CaretDown,\n  CheckCircle,\n  FileImage,\n  MapPinLine,\n  WarningCircle,\n} from \"@phosphor-icons/react\";\n\nimport { Alert } from \"@/components/ui/alert\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useGeolocation } from \"@/hooks/use-geolocation\";\nimport { useCamera } from \"@/hooks/use-camera\";\nimport { bhabinService } from \"@/services/bhabin-service\";\nimport type { GeoPoint, RecipientVerification } from \"@/types/bhabin\";\n\nconst harvestSchema = z.object({\n  recipientId: z.string().min(1, \"Pilih petani\"),\n  luasPanenHa: z.coerce.number().min(0.1, \"Minimal 0.1 Ha\"),\n  produksiTon: z.coerce.number().min(0, \"Minimal 0\"),\n  lokasi: z.string().min(2, \"Wajib diisi\"),\n  keterangan: z.string().optional(),\n});\n\ntype HarvestFormValues = z.infer<typeof harvestSchema>;\n\ntype FeedbackState = {\n  type: \"success\" | \"error\" | \"info\";\n  message: string;\n};\n\nconst dropdownDisplay = (recipient: RecipientVerification | null) => {\n  if (!recipient) {\n    return \"-- pilih petani --\";\n  }\n  return `${recipient.nama} • ${recipient.komoditas} • ${recipient.wilayah}`;\n};\n\nconst formatDateTime = (iso: string) => new Date(iso).toLocaleString(\"id-ID\", { dateStyle: \"medium\", timeStyle: \"short\" });\n\nconst HarvestVerificationPage = () => {\n  const queryClient = useQueryClient();\n  const [feedback, setFeedback] = useState<FeedbackState | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isDropdownOpen, setDropdownOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement | null>(null);\n  const searchInputRef = useRef<HTMLInputElement | null>(null);\n  const lokasi = useGeolocation();\n  const camera = useCamera();\n\n  const recipientsQuery = useQuery({\n    queryKey: [\"bhabin\", \"recipients\"],\n    queryFn: () => bhabinService.listRecipients(),\n  });\n\n  const recipients = useMemo(() => recipientsQuery.data ?? [], [recipientsQuery.data]);\n  const selectableRecipients = useMemo(() => recipients.filter((item) => item.status !== \"rejected\"), [recipients]);\n  const filteredRecipients = useMemo(() => {\n    const keyword = searchTerm.trim().toLowerCase();\n    if (!keyword) return selectableRecipients;\n    return selectableRecipients.filter((item) => {\n      const combined = `${item.nama} ${item.nik} ${item.komoditas} ${item.wilayah}`.toLowerCase();\n      return combined.includes(keyword);\n    });\n  }, [selectableRecipients, searchTerm]);\n\n  const form = useForm<HarvestFormValues>({\n    resolver: zodResolver(harvestSchema),\n    defaultValues: {\n      recipientId: \"\",\n      luasPanenHa: 1,\n      produksiTon: 0,\n      lokasi: \"\",\n      keterangan: \"\",\n    },\n  });\n\n  const recipientId = form.watch(\"recipientId\");\n  const selectedRecipient = useMemo(\n    () => recipients.find((item) => item.id === recipientId) ?? null,\n    [recipientId, recipients]\n  );\n\n  useEffect(() => {\n    if (!isDropdownOpen) {\n      setSearchTerm(\"\");\n      return;\n    }\n    const handler = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setDropdownOpen(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handler);\n    return () => document.removeEventListener(\"mousedown\", handler);\n  }, [isDropdownOpen]);\n\n  useEffect(() => {\n    if (isDropdownOpen) {\n      const timer = window.setTimeout(() => searchInputRef.current?.focus(), 0);\n      return () => window.clearTimeout(timer);\n    }\n    return undefined;\n  }, [isDropdownOpen]);\n\n  const handleRecipientSelect = (recipient: RecipientVerification) => {\n    form.setValue(\"recipientId\", recipient.id, { shouldValidate: true, shouldDirty: true });\n    form.clearErrors(\"recipientId\");\n    setDropdownOpen(false);\n  };\n\n  const query = useQuery({\n    queryKey: [\"bhabin\", \"harvest\"],\n    queryFn: () => bhabinService.listHarvestVerifications(),\n  });\n\n  const mutation = useMutation({\n    mutationFn: (payload: HarvestFormValues & { koordinat: GeoPoint; fotoEvidence: string; verifier: string; petani: string; komoditas: string }) =>\n      bhabinService.submitHarvestVerification(payload),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"bhabin\", \"harvest\"] });\n      setFeedback({ type: \"success\", message: \"Verifikasi hasil panen tersimpan.\" });\n      form.reset({ recipientId: \"\", luasPanenHa: 1, produksiTon: 0, lokasi: \"\", keterangan: \"\" });\n      camera.restart();\n    },\n    onError: () => setFeedback({ type: \"error\", message: \"Gagal menyimpan verifikasi panen.\" }),\n  });\n\n  const handleSubmit = (values: HarvestFormValues) => {\n    if (!selectedRecipient) {\n      setFeedback({ type: \"error\", message: \"Pilih petani terlebih dahulu.\" });\n      setDropdownOpen(true);\n      return;\n    }\n    if (!lokasi.latitude || !lokasi.longitude) {\n      setFeedback({ type: \"error\", message: \"GPS belum siap. Tekan segarkan dan pastikan izin lokasi aktif.\" });\n      return;\n    }\n    if (!camera.preview) {\n      setFeedback({ type: \"error\", message: \"Ambil foto hasil panen terlebih dahulu.\" });\n      return;\n    }\n\n    setFeedback(null);\n    mutation.mutate({\n      ...values,\n      petani: selectedRecipient.nama,\n      komoditas: selectedRecipient.komoditas,\n      koordinat: {\n        latitude: lokasi.latitude,\n        longitude: lokasi.longitude,\n        alamat: lokasi.alamat,\n      },\n      fotoEvidence: camera.preview,\n      verifier: \"bhabin\",\n    });\n  };\n\n  return (\n    <section className=\"grid gap-4 xl:grid-cols-[1fr_1fr]\">\n      <Card className=\"bg-white\">\n        <CardHeader>\n          <CardTitle>Verifikasi hasil panen</CardTitle>\n          <CardDescription>Catat hasil panen yang sudah diverifikasi di lapangan.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-3 text-sm text-slate-netral\">\n          {feedback && (\n            <Alert variant={feedback.type === \"success\" ? \"success\" : feedback.type === \"error\" ? \"error\" : \"info\"}>\n              <div className=\"flex items-center gap-2\">\n                {feedback.type === \"success\" ? (\n                  <CheckCircle className=\"h-5 w-5\" weight=\"bold\" />\n                ) : (\n                  <WarningCircle className=\"h-5 w-5\" weight=\"bold\" />\n                )}\n                <span>{feedback.message}</span>\n              </div>\n            </Alert>\n          )}\n\n          <form className=\"space-y-3\" onSubmit={form.handleSubmit(handleSubmit)}>\n            <div className=\"flex flex-col gap-2\">\n              <span>Pilih petani penerima</span>\n              <div className=\"relative\" ref={dropdownRef}>\n                <button\n                  type=\"button\"\n                  className=\"flex w-full items-center justify-between rounded-2xl border border-abu-kartu px-3 py-2 text-left text-sm text-teks-gelap hover:border-biru-pemerintah/60\"\n                  onClick={() => selectableRecipients.length > 0 && setDropdownOpen((prev) => !prev)}\n                  disabled={selectableRecipients.length === 0}\n                >\n                  <span className={selectedRecipient ? \"\" : \"text-slate-netral\"}>{dropdownDisplay(selectedRecipient)}</span>\n                  <CaretDown className=\"ml-2 h-4 w-4 text-slate-netral\" weight=\"bold\" />\n                </button>\n                {isDropdownOpen && (\n                  <div className=\"absolute z-30 mt-2 w-full rounded-2xl border border-abu-kartu bg-white p-3 shadow-xl\">\n                    <input\n                      ref={searchInputRef}\n                      type=\"search\"\n                      className=\"w-full rounded-2xl border border-abu-kartu px-3 py-2 text-sm\"\n                      placeholder=\"Cari nama, NIK, komoditas, atau wilayah\"\n                      value={searchTerm}\n                      onChange={(event) => setSearchTerm(event.target.value)}\n                    />\n                    <div className=\"mt-2 max-h-60 overflow-y-auto\">\n                      {filteredRecipients.length > 0 ? (\n                        filteredRecipients.map((petani) => {\n                          const isSelected = petani.id === recipientId;\n                          return (\n                            <button\n                              type=\"button\"\n                              key={petani.id}\n                              className={`flex w-full flex-col items-start rounded-xl px-3 py-2 text-left text-sm transition hover:bg-biru-pemerintah/10 ${\n                                isSelected ? \"bg-biru-pemerintah/10 text-biru-pemerintah\" : \"text-teks-gelap\"\n                              }`}\n                              onClick={() => handleRecipientSelect(petani)}\n                            >\n                              <span className=\"font-medium\">{petani.nama}</span>\n                              <span className=\"text-xs text-slate-netral\">\n                                {petani.nik} • {petani.komoditas} • {petani.wilayah}\n                              </span>\n                            </button>\n                          );\n                        })\n                      ) : (\n                        <p className=\"px-2 py-4 text-center text-sm text-slate-netral\">Tidak ditemukan data sesuai pencarian.</p>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n              {selectableRecipients.length === 0 && <span className=\"text-xs text-slate-netral\">Belum ada data penerima.</span>}\n              {form.formState.errors.recipientId && (\n                <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.recipientId.message}</span>\n              )}\n            </div>\n\n            {selectedRecipient && (\n              <div className=\"rounded-2xl border border-abu-kartu bg-white p-3 text-xs text-slate-netral\">\n                <p className=\"text-sm font-semibold text-teks-gelap\">{selectedRecipient.nama}</p>\n                <p>NIK: {selectedRecipient.nik}</p>\n                <p>Kelompok: {selectedRecipient.kelompok}</p>\n                <p>Komoditas: {selectedRecipient.komoditas}</p>\n                <p>Wilayah: {selectedRecipient.wilayah}</p>\n                <p>Jadwal distribusi: {formatDateTime(selectedRecipient.jadwalDistribusi)}</p>\n              </div>\n            )}\n\n            <div className=\"grid gap-3 md:grid-cols-2\">\n              <label className=\"flex flex-col gap-1\">\n                Luas panen (Ha)\n                <input type=\"number\" step=\"0.01\" min={0.1} className=\"rounded-2xl border border-abu-kartu px-3 py-2\" {...form.register(\"luasPanenHa\", { valueAsNumber: true })} />\n                {form.formState.errors.luasPanenHa && <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.luasPanenHa.message}</span>}\n              </label>\n              <label className=\"flex flex-col gap-1\">\n                Produksi (Ton)\n                <input type=\"number\" step=\"0.01\" min={0} className=\"rounded-2xl border border-abu-kartu px-3 py-2\" {...form.register(\"produksiTon\", { valueAsNumber: true })} />\n                {form.formState.errors.produksiTon && <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.produksiTon.message}</span>}\n              </label>\n            </div>\n            <label className=\"flex flex-col gap-1\">\n              Lokasi penyimpanan hasil panen\n              <input className=\"rounded-2xl border border-abu-kartu px-3 py-2\" {...form.register(\"lokasi\")} />\n              {form.formState.errors.lokasi && <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.lokasi.message}</span>}\n            </label>\n            <label className=\"flex flex-col gap-1\">\n              Keterangan tambahan\n              <textarea className=\"rounded-2xl border border-abu-kartu px-3 py-2\" rows={3} {...form.register(\"keterangan\")} />\n            </label>\n\n            <div className=\"space-y-2 rounded-2xl border border-abu-kartu p-3\">\n              <div className=\"flex items-center justify-between\">\n                <p className=\"text-sm font-medium text-teks-gelap\">Koordinat lokasi</p>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={lokasi.refresh}\n                  disabled={lokasi.isLoading}\n                  className=\"inline-flex items-center gap-1\"\n                >\n                  <ArrowsClockwise className={`h-4 w-4 ${lokasi.isLoading ? \"animate-spin\" : \"\"}`} weight=\"bold\" />\n                  <span>{lokasi.isLoading ? \"Memuat\" : \"Segarkan\"}</span>\n                </Button>\n              </div>\n              <div className=\"flex items-start gap-2 text-xs text-slate-netral\">\n                <MapPinLine className=\"mt-0.5 h-4 w-4\" weight=\"bold\" />\n                <div>\n                  {lokasi.latitude && lokasi.longitude ? (\n                    <>\n                      <p>{lokasi.alamat}</p>\n                      <p>\n                        Lat {lokasi.latitude.toFixed(4)} | Long {lokasi.longitude.toFixed(4)}\n                      </p>\n                    </>\n                  ) : lokasi.isLoading ? (\n                    <p>Mengambil lokasi terkini...</p>\n                  ) : (\n                    <p>Lokasi belum tersedia. Pastikan izin GPS aktif lalu tekan segarkan.</p>\n                  )}\n                  {lokasi.error && <p className=\"text-oranye-hangat\">{lokasi.error}</p>}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-3 rounded-2xl border border-abu-kartu p-3\">\n              <p className=\"text-sm font-medium text-teks-gelap\">Dokumentasi hasil panen</p>\n              {camera.streamError && <Alert variant=\"warning\">{camera.streamError}</Alert>}\n              {!camera.preview ? (\n                <div className=\"space-y-3\">\n                  <video ref={camera.videoRef} autoPlay playsInline className=\"h-56 w-full rounded-2xl bg-black/60 object-cover\" />\n                  <canvas ref={camera.canvasRef} className=\"hidden\" />\n                  <Button type=\"button\" className=\"w-full\" onClick={camera.capturePhoto}>\n                    <Camera className=\"mr-2 h-5 w-5\" weight=\"bold\" /> Ambil Foto\n                  </Button>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  <img src={camera.preview} alt=\"Dokumentasi panen\" className=\"h-56 w-full rounded-2xl object-cover\" />\n                  <Button type=\"button\" variant=\"outline\" onClick={camera.restart}>\n                    <FileImage className=\"mr-2 h-5 w-5\" weight=\"bold\" /> Ambil Ulang\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            <Button type=\"submit\" className=\"w-full\" disabled={mutation.isPending}>\n              {mutation.isPending ? \"Menyimpan...\" : \"Simpan verifikasi\"}\n            </Button>\n            <Alert variant=\"info\" className=\"text-xs\">\n              Data disimpan otomatis meski offline dan akan tersinkron ketika koneksi kembali.\n            </Alert>\n          </form>\n        </CardContent>\n      </Card>\n\n      <Card className=\"bg-white\">\n        <CardHeader>\n          <CardTitle>Riwayat verifikasi panen</CardTitle>\n          <CardDescription>Daftar panen yang telah Anda cek.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-2 text-xs text-slate-netral\">\n          {(query.data ?? []).map((item) => (\n            <div key={item.id} className=\"rounded-2xl border border-abu-kartu p-3\">\n              <p className=\"text-sm font-medium text-teks-gelap\">{item.petani}</p>\n              <p>Komoditas: {item.komoditas}</p>\n              <p>Luas panen: {item.luasPanenHa} Ha</p>\n              <p>Produksi: {item.produksiTon} Ton</p>\n              <p>Lokasi penyimpanan: {item.lokasi}</p>\n              <p>Diverifikasi: {formatDateTime(item.diverifikasiAt)}</p>\n              {item.koordinat && (\n                <p>\n                  Koordinat: Lat {item.koordinat.latitude.toFixed(4)} | Long {item.koordinat.longitude.toFixed(4)}\n                </p>\n              )}\n              {item.keterangan && <p>Keterangan: {item.keterangan}</p>}\n              {item.fotoEvidence && (\n                <img src={item.fotoEvidence} alt={`Dokumentasi panen ${item.petani}`} className=\"mt-2 h-32 w-full rounded-2xl object-cover\" />\n              )}\n            </div>\n          ))}\n        </CardContent>\n      </Card>\n    </section>\n  );\n};\n\nexport default HarvestVerificationPage;\r\n"],"names":["harvestSchema","z.object","z.string","z.coerce","dropdownDisplay","recipient","formatDateTime","iso","HarvestVerificationPage","queryClient","useQueryClient","feedback","setFeedback","useState","searchTerm","setSearchTerm","isDropdownOpen","setDropdownOpen","dropdownRef","useRef","searchInputRef","lokasi","useGeolocation","camera","useCamera","recipientsQuery","useQuery","bhabinService","recipients","useMemo","selectableRecipients","item","filteredRecipients","keyword","form","useForm","zodResolver","recipientId","selectedRecipient","useEffect","handler","event","timer","_a","handleRecipientSelect","query","mutation","useMutation","payload","handleSubmit","values","jsxs","Card","CardHeader","jsx","CardTitle","CardDescription","CardContent","Alert","CheckCircle","WarningCircle","prev","CaretDown","petani","isSelected","Button","ArrowsClockwise","MapPinLine","Fragment","FileImage","Camera"],"mappings":"8sBAuBA,MAAMA,EAAgBC,EAAS,CAC7B,YAAaC,EAAE,EAAS,IAAI,EAAG,cAAc,EAC7C,YAAaC,EAAS,SAAS,IAAI,GAAK,gBAAgB,EACxD,YAAaA,EAAS,SAAS,IAAI,EAAG,WAAW,EACjD,OAAQD,EAAE,EAAS,IAAI,EAAG,aAAa,EACvC,WAAYA,EAAE,EAAS,SAAA,CACzB,CAAC,EASKE,EAAmBC,GAClBA,EAGE,GAAGA,EAAU,IAAI,MAAMA,EAAU,SAAS,MAAMA,EAAU,OAAO,GAF/D,qBAKLC,EAAkBC,GAAgB,IAAI,KAAKA,CAAG,EAAE,eAAe,QAAS,CAAE,UAAW,SAAU,UAAW,QAAS,EAEnHC,GAA0B,IAAM,CACpC,MAAMC,EAAcC,EAAA,EACd,CAACC,EAAUC,CAAW,EAAIC,EAAAA,SAA+B,IAAI,EAC7D,CAACC,EAAYC,CAAa,EAAIF,EAAAA,SAAS,EAAE,EACzC,CAACG,EAAgBC,CAAe,EAAIJ,EAAAA,SAAS,EAAK,EAClDK,EAAcC,EAAAA,OAA8B,IAAI,EAChDC,EAAiBD,EAAAA,OAAgC,IAAI,EACrDE,EAASC,EAAA,EACTC,EAASC,EAAA,EAETC,EAAkBC,EAAS,CAC/B,SAAU,CAAC,SAAU,YAAY,EACjC,QAAS,IAAMC,EAAc,eAAA,CAAe,CAC7C,EAEKC,EAAaC,EAAAA,QAAQ,IAAMJ,EAAgB,MAAQ,GAAI,CAACA,EAAgB,IAAI,CAAC,EAC7EK,EAAuBD,EAAAA,QAAQ,IAAMD,EAAW,OAAQG,GAASA,EAAK,SAAW,UAAU,EAAG,CAACH,CAAU,CAAC,EAC1GI,EAAqBH,EAAAA,QAAQ,IAAM,CACvC,MAAMI,EAAUnB,EAAW,KAAA,EAAO,YAAA,EAClC,OAAKmB,EACEH,EAAqB,OAAQC,GACjB,GAAGA,EAAK,IAAI,IAAIA,EAAK,GAAG,IAAIA,EAAK,SAAS,IAAIA,EAAK,OAAO,GAAG,YAAA,EAC9D,SAASE,CAAO,CACjC,EAJoBH,CAKvB,EAAG,CAACA,EAAsBhB,CAAU,CAAC,EAE/BoB,EAAOC,EAA2B,CACtC,SAAUC,EAAYpC,CAAa,EACnC,cAAe,CACb,YAAa,GACb,YAAa,EACb,YAAa,EACb,OAAQ,GACR,WAAY,EAAA,CACd,CACD,EAEKqC,EAAcH,EAAK,MAAM,aAAa,EACtCI,EAAoBT,EAAAA,QACxB,IAAMD,EAAW,KAAMG,GAASA,EAAK,KAAOM,CAAW,GAAK,KAC5D,CAACA,EAAaT,CAAU,CAAA,EAG1BW,EAAAA,UAAU,IAAM,CACd,GAAI,CAACvB,EAAgB,CACnBD,EAAc,EAAE,EAChB,MACF,CACA,MAAMyB,EAAWC,GAAsB,CACjCvB,EAAY,SAAW,CAACA,EAAY,QAAQ,SAASuB,EAAM,MAAc,GAC3ExB,EAAgB,EAAK,CAEzB,EACA,gBAAS,iBAAiB,YAAauB,CAAO,EACvC,IAAM,SAAS,oBAAoB,YAAaA,CAAO,CAChE,EAAG,CAACxB,CAAc,CAAC,EAEnBuB,EAAAA,UAAU,IAAM,CACd,GAAIvB,EAAgB,CAClB,MAAM0B,EAAQ,OAAO,WAAW,IAAA,OAAM,OAAAC,EAAAvB,EAAe,UAAf,YAAAuB,EAAwB,SAAS,CAAC,EACxE,MAAO,IAAM,OAAO,aAAaD,CAAK,CACxC,CAEF,EAAG,CAAC1B,CAAc,CAAC,EAEnB,MAAM4B,EAAyBvC,GAAqC,CAClE6B,EAAK,SAAS,cAAe7B,EAAU,GAAI,CAAE,eAAgB,GAAM,YAAa,GAAM,EACtF6B,EAAK,YAAY,aAAa,EAC9BjB,EAAgB,EAAK,CACvB,EAEM4B,EAAQnB,EAAS,CACrB,SAAU,CAAC,SAAU,SAAS,EAC9B,QAAS,IAAMC,EAAc,yBAAA,CAAyB,CACvD,EAEKmB,EAAWC,EAAY,CAC3B,WAAaC,GACXrB,EAAc,0BAA0BqB,CAAO,EACjD,UAAW,IAAM,CACfvC,EAAY,kBAAkB,CAAE,SAAU,CAAC,SAAU,SAAS,EAAG,EACjEG,EAAY,CAAE,KAAM,UAAW,QAAS,oCAAqC,EAC7EsB,EAAK,MAAM,CAAE,YAAa,GAAI,YAAa,EAAG,YAAa,EAAG,OAAQ,GAAI,WAAY,EAAA,CAAI,EAC1FX,EAAO,QAAA,CACT,EACA,QAAS,IAAMX,EAAY,CAAE,KAAM,QAAS,QAAS,oCAAqC,CAAA,CAC3F,EAEKqC,EAAgBC,GAA8B,CAClD,GAAI,CAACZ,EAAmB,CACtB1B,EAAY,CAAE,KAAM,QAAS,QAAS,gCAAiC,EACvEK,EAAgB,EAAI,EACpB,MACF,CACA,GAAI,CAACI,EAAO,UAAY,CAACA,EAAO,UAAW,CACzCT,EAAY,CAAE,KAAM,QAAS,QAAS,iEAAkE,EACxG,MACF,CACA,GAAI,CAACW,EAAO,QAAS,CACnBX,EAAY,CAAE,KAAM,QAAS,QAAS,0CAA2C,EACjF,MACF,CAEAA,EAAY,IAAI,EAChBkC,EAAS,OAAO,CACd,GAAGI,EACH,OAAQZ,EAAkB,KAC1B,UAAWA,EAAkB,UAC7B,UAAW,CACT,SAAUjB,EAAO,SACjB,UAAWA,EAAO,UAClB,OAAQA,EAAO,MAAA,EAEjB,aAAcE,EAAO,QACrB,SAAU,QAAA,CACX,CACH,EAEA,OACE4B,EAAAA,KAAC,UAAA,CAAQ,UAAU,oCACjB,SAAA,CAAAA,EAAAA,KAACC,EAAA,CAAK,UAAU,WACd,SAAA,CAAAD,OAACE,EAAA,CACC,SAAA,CAAAC,EAAAA,IAACC,GAAU,SAAA,wBAAA,CAAsB,EACjCD,EAAAA,IAACE,GAAgB,SAAA,wDAAA,CAAsD,CAAA,EACzE,EACAL,EAAAA,KAACM,EAAA,CAAY,UAAU,sCACpB,SAAA,CAAA9C,GACC2C,EAAAA,IAACI,EAAA,CAAM,QAAS/C,EAAS,OAAS,UAAY,UAAYA,EAAS,OAAS,QAAU,QAAU,OAC9F,SAAAwC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAAxC,EAAS,OAAS,UACjB2C,EAAAA,IAACK,EAAA,CAAY,UAAU,UAAU,OAAO,MAAA,CAAO,EAE/CL,EAAAA,IAACM,EAAA,CAAc,UAAU,UAAU,OAAO,OAAO,EAEnDN,EAAAA,IAAC,OAAA,CAAM,SAAA3C,EAAS,OAAA,CAAQ,CAAA,CAAA,CAC1B,CAAA,CACF,EAGFwC,OAAC,QAAK,UAAU,YAAY,SAAUjB,EAAK,aAAae,CAAY,EAClE,SAAA,CAAAE,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAG,EAAAA,IAAC,QAAK,SAAA,uBAAA,CAAqB,EAC3BH,EAAAA,KAAC,MAAA,CAAI,UAAU,WAAW,IAAKjC,EAC7B,SAAA,CAAAiC,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,UAAU,2JACV,QAAS,IAAMrB,EAAqB,OAAS,GAAKb,EAAiB4C,GAAS,CAACA,CAAI,EACjF,SAAU/B,EAAqB,SAAW,EAE1C,SAAA,CAAAwB,EAAAA,IAAC,QAAK,UAAWhB,EAAoB,GAAK,oBAAsB,SAAAlC,EAAgBkC,CAAiB,EAAE,EACnGgB,EAAAA,IAACQ,EAAA,CAAU,UAAU,iCAAiC,OAAO,MAAA,CAAO,CAAA,CAAA,CAAA,EAErE9C,GACCmC,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACb,SAAA,CAAAG,EAAAA,IAAC,QAAA,CACC,IAAKlC,EACL,KAAK,SACL,UAAU,+DACV,YAAY,0CACZ,MAAON,EACP,SAAW2B,GAAU1B,EAAc0B,EAAM,OAAO,KAAK,CAAA,CAAA,EAEvDa,EAAAA,IAAC,MAAA,CAAI,UAAU,gCACZ,SAAAtB,EAAmB,OAAS,EAC3BA,EAAmB,IAAK+B,GAAW,CACjC,MAAMC,EAAaD,EAAO,KAAO1B,EACjC,OACEc,EAAAA,KAAC,SAAA,CACC,KAAK,SAEL,UAAW,kHACTa,EAAa,6CAA+C,iBAC9D,GACA,QAAS,IAAMpB,EAAsBmB,CAAM,EAE3C,SAAA,CAAAT,EAAAA,IAAC,OAAA,CAAK,UAAU,cAAe,SAAAS,EAAO,KAAK,EAC3CZ,EAAAA,KAAC,OAAA,CAAK,UAAU,4BACb,SAAA,CAAAY,EAAO,IAAI,MAAIA,EAAO,UAAU,MAAIA,EAAO,OAAA,CAAA,CAC9C,CAAA,CAAA,EATKA,EAAO,EAAA,CAYlB,CAAC,EAEDT,EAAAA,IAAC,KAAE,UAAU,kDAAkD,kDAAsC,CAAA,CAEzG,CAAA,CAAA,CACF,CAAA,EAEJ,EACCxB,EAAqB,SAAW,SAAM,OAAA,CAAK,UAAU,4BAA4B,SAAA,2BAAwB,EACzGI,EAAK,UAAU,OAAO,aACrBoB,EAAAA,IAAC,OAAA,CAAK,UAAU,6BAA8B,SAAApB,EAAK,UAAU,OAAO,YAAY,OAAA,CAAQ,CAAA,EAE5F,EAECI,GACCa,EAAAA,KAAC,MAAA,CAAI,UAAU,6EACb,SAAA,CAAAG,EAAAA,IAAC,IAAA,CAAE,UAAU,wCAAyC,SAAAhB,EAAkB,KAAK,SAC5E,IAAA,CAAE,SAAA,CAAA,QAAMA,EAAkB,GAAA,EAAI,SAC9B,IAAA,CAAE,SAAA,CAAA,aAAWA,EAAkB,QAAA,EAAS,SACxC,IAAA,CAAE,SAAA,CAAA,cAAYA,EAAkB,SAAA,EAAU,SAC1C,IAAA,CAAE,SAAA,CAAA,YAAUA,EAAkB,OAAA,EAAQ,SACtC,IAAA,CAAE,SAAA,CAAA,sBAAoBhC,EAAegC,EAAkB,gBAAgB,CAAA,CAAA,CAAE,CAAA,EAC5E,EAGFa,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAA,EAAAA,KAAC,QAAA,CAAM,UAAU,sBAAsB,SAAA,CAAA,wBAEpC,QAAA,CAAM,KAAK,SAAS,KAAK,OAAO,IAAK,GAAK,UAAU,gDAAiD,GAAGjB,EAAK,SAAS,cAAe,CAAE,cAAe,EAAA,CAAM,EAAG,EAC/JA,EAAK,UAAU,OAAO,aAAeoB,EAAAA,IAAC,OAAA,CAAK,UAAU,6BAA8B,SAAApB,EAAK,UAAU,OAAO,YAAY,OAAA,CAAQ,CAAA,EAChI,EACAiB,EAAAA,KAAC,QAAA,CAAM,UAAU,sBAAsB,SAAA,CAAA,uBAEpC,QAAA,CAAM,KAAK,SAAS,KAAK,OAAO,IAAK,EAAG,UAAU,gDAAiD,GAAGjB,EAAK,SAAS,cAAe,CAAE,cAAe,EAAA,CAAM,EAAG,EAC7JA,EAAK,UAAU,OAAO,aAAeoB,EAAAA,IAAC,OAAA,CAAK,UAAU,6BAA8B,SAAApB,EAAK,UAAU,OAAO,YAAY,OAAA,CAAQ,CAAA,CAAA,CAChI,CAAA,EACF,EACAiB,EAAAA,KAAC,QAAA,CAAM,UAAU,sBAAsB,SAAA,CAAA,iCAErCG,MAAC,SAAM,UAAU,gDAAiD,GAAGpB,EAAK,SAAS,QAAQ,EAAG,EAC7FA,EAAK,UAAU,OAAO,QAAUoB,EAAAA,IAAC,OAAA,CAAK,UAAU,6BAA8B,SAAApB,EAAK,UAAU,OAAO,OAAO,OAAA,CAAQ,CAAA,EACtH,EACAiB,EAAAA,KAAC,QAAA,CAAM,UAAU,sBAAsB,SAAA,CAAA,sBAErCG,EAAAA,IAAC,WAAA,CAAS,UAAU,gDAAgD,KAAM,EAAI,GAAGpB,EAAK,SAAS,YAAY,CAAA,CAAG,CAAA,EAChH,EAEAiB,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAG,EAAAA,IAAC,IAAA,CAAE,UAAU,sCAAsC,SAAA,mBAAgB,EACnEH,EAAAA,KAACc,EAAA,CACC,KAAK,SACL,QAAQ,UACR,KAAK,KACL,QAAS5C,EAAO,QAChB,SAAUA,EAAO,UACjB,UAAU,iCAEV,SAAA,CAAAiC,EAAAA,IAACY,EAAA,CAAgB,UAAW,WAAW7C,EAAO,UAAY,eAAiB,EAAE,GAAI,OAAO,MAAA,CAAO,EAC/FiC,EAAAA,IAAC,OAAA,CAAM,SAAAjC,EAAO,UAAY,SAAW,UAAA,CAAW,CAAA,CAAA,CAAA,CAClD,EACF,EACA8B,EAAAA,KAAC,MAAA,CAAI,UAAU,mDACb,SAAA,CAAAG,EAAAA,IAACa,EAAA,CAAW,UAAU,iBAAiB,OAAO,OAAO,SACpD,MAAA,CACE,SAAA,CAAA9C,EAAO,UAAYA,EAAO,UACzB8B,EAAAA,KAAAiB,EAAAA,SAAA,CACE,SAAA,CAAAd,EAAAA,IAAC,IAAA,CAAG,WAAO,MAAA,CAAO,SACjB,IAAA,CAAE,SAAA,CAAA,OACIjC,EAAO,SAAS,QAAQ,CAAC,EAAE,WAASA,EAAO,UAAU,QAAQ,CAAC,CAAA,CAAA,CACrE,CAAA,CAAA,CACF,EACEA,EAAO,UACTiC,EAAAA,IAAC,KAAE,SAAA,6BAAA,CAA2B,EAE9BA,EAAAA,IAAC,IAAA,CAAE,SAAA,qEAAA,CAAmE,EAEvEjC,EAAO,OAASiC,EAAAA,IAAC,KAAE,UAAU,qBAAsB,WAAO,KAAA,CAAM,CAAA,CAAA,CACnE,CAAA,CAAA,CACF,CAAA,EACF,EAEAH,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAG,EAAAA,IAAC,IAAA,CAAE,UAAU,sCAAsC,SAAA,0BAAuB,EACzE/B,EAAO,aAAe+B,EAAAA,IAACI,GAAM,QAAQ,UAAW,WAAO,YAAY,EAClEnC,EAAO,QASP4B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAG,MAAC,OAAI,IAAK/B,EAAO,QAAS,IAAI,oBAAoB,UAAU,uCAAuC,EACnG4B,EAAAA,KAACc,GAAO,KAAK,SAAS,QAAQ,UAAU,QAAS1C,EAAO,QACtD,SAAA,CAAA+B,EAAAA,IAACe,EAAA,CAAU,UAAU,eAAe,OAAO,OAAO,EAAE,cAAA,CAAA,CACtD,CAAA,CAAA,CACF,EAbAlB,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAG,EAAAA,IAAC,QAAA,CAAM,IAAK/B,EAAO,SAAU,SAAQ,GAAC,YAAW,GAAC,UAAU,kDAAA,CAAmD,QAC9G,SAAA,CAAO,IAAKA,EAAO,UAAW,UAAU,SAAS,EAClD4B,EAAAA,KAACc,GAAO,KAAK,SAAS,UAAU,SAAS,QAAS1C,EAAO,aACvD,SAAA,CAAA+B,EAAAA,IAACgB,EAAA,CAAO,UAAU,eAAe,OAAO,OAAO,EAAE,aAAA,CAAA,CACnD,CAAA,CAAA,CACF,CAOA,EAEJ,EAEAhB,EAAAA,IAACW,EAAA,CAAO,KAAK,SAAS,UAAU,SAAS,SAAUnB,EAAS,UACzD,SAAAA,EAAS,UAAY,eAAiB,oBACzC,QACCY,EAAA,CAAM,QAAQ,OAAO,UAAU,UAAU,SAAA,kFAAA,CAE1C,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,EAEAP,EAAAA,KAACC,EAAA,CAAK,UAAU,WACd,SAAA,CAAAD,OAACE,EAAA,CACC,SAAA,CAAAC,EAAAA,IAACC,GAAU,SAAA,0BAAA,CAAwB,EACnCD,EAAAA,IAACE,GAAgB,SAAA,mCAAA,CAAiC,CAAA,EACpD,EACAF,EAAAA,IAACG,EAAA,CAAY,UAAU,sCACnB,YAAM,MAAQ,CAAA,GAAI,IAAK1B,GACvBoB,EAAAA,KAAC,MAAA,CAAkB,UAAU,0CAC3B,SAAA,CAAAG,EAAAA,IAAC,IAAA,CAAE,UAAU,sCAAuC,SAAAvB,EAAK,OAAO,SAC/D,IAAA,CAAE,SAAA,CAAA,cAAYA,EAAK,SAAA,EAAU,SAC7B,IAAA,CAAE,SAAA,CAAA,eAAaA,EAAK,YAAY,KAAA,EAAG,SACnC,IAAA,CAAE,SAAA,CAAA,aAAWA,EAAK,YAAY,MAAA,EAAI,SAClC,IAAA,CAAE,SAAA,CAAA,uBAAqBA,EAAK,MAAA,EAAO,SACnC,IAAA,CAAE,SAAA,CAAA,iBAAezB,EAAeyB,EAAK,cAAc,CAAA,EAAE,EACrDA,EAAK,WACJoB,EAAAA,KAAC,IAAA,CAAE,SAAA,CAAA,kBACepB,EAAK,UAAU,SAAS,QAAQ,CAAC,EAAE,WAASA,EAAK,UAAU,UAAU,QAAQ,CAAC,CAAA,EAChG,EAEDA,EAAK,YAAcoB,EAAAA,KAAC,IAAA,CAAE,SAAA,CAAA,eAAapB,EAAK,UAAA,EAAW,EACnDA,EAAK,cACJuB,EAAAA,IAAC,MAAA,CAAI,IAAKvB,EAAK,aAAc,IAAK,qBAAqBA,EAAK,MAAM,GAAI,UAAU,2CAAA,CAA4C,CAAA,GAdtHA,EAAK,EAgBf,CACD,CAAA,CACH,CAAA,CAAA,CACF,CAAA,EACF,CAEJ"}