import{u as f,n as k,r as w,j as e,B as N}from"./index-Cb9iWb3X.js";import{u as P,t as S,o as v,s as l,c as u}from"./zod-PrevpNNo.js";import{u as C}from"./useQuery-C79pYyAu.js";import{u as K,m as q}from"./WarningCircle.es-D9kSxDjz.js";import{s as D}from"./CheckCircle.es-CuiNzjdL.js";import{A as B}from"./alert-CMpuOtHs.js";import{B as E}from"./badge-BudpMpDX.js";import{C as c,a as d,b as m,c as x,d as p}from"./card-D9DWCS54.js";import{b as h}from"./bhabin-service-1Ii3Tmwo.js";import"./mock-data-Bmemdn2s.js";const A=v({wilayah:l().min(2,"Wajib diisi"),jadwal:l().min(1,"Pilih jadwal"),titikKumpul:l().min(3,"Wajib diisi"),estimasiPeserta:u.number().min(1,"Minimal 1 orang"),kebutuhanPersonel:u.number().min(1,"Minimal 1 personel"),catatan:l().optional()}),b={baru:{label:"Menunggu",variant:"warning"},dijadwalkan:{label:"Dijadwalkan",variant:"neutral"},selesai:{label:"Selesai",variant:"success"}},j=r=>new Date(r).toLocaleString("id-ID",{dateStyle:"medium",timeStyle:"short"}),I=()=>{const{user:r}=f(),g=k(),[t,i]=w.useState(null),a=P({resolver:S(A),defaultValues:{wilayah:"",jadwal:"",titikKumpul:"",estimasiPeserta:20,kebutuhanPersonel:4,catatan:""}}),y=C({queryKey:["bhabin","escort"],queryFn:()=>h.listEscortRequests()}),n=K({mutationFn:s=>h.submitEscortRequest({...s,diajukanOleh:(r==null?void 0:r.email)??"bhabin@polda.ntt.gov.id"}),onSuccess:()=>{g.invalidateQueries({queryKey:["bhabin","escort"]}),i({type:"success",message:"Permintaan pengawalan terkirim."}),a.reset({wilayah:"",jadwal:"",titikKumpul:"",estimasiPeserta:20,kebutuhanPersonel:4,catatan:""})},onError:()=>i({type:"error",message:"Gagal mengirim permintaan. Coba ulangi."})}),o=y.data??[];return e.jsxs("section",{className:"grid gap-4 xl:grid-cols-[1fr_1fr]",children:[e.jsxs(c,{className:"bg-white",children:[e.jsxs(d,{children:[e.jsx(m,{children:"Permintaan pengawalan panen"}),e.jsx(x,{children:"Kirim jadwal kawalan ke Polres untuk dukungan personel."})]}),e.jsxs(p,{className:"space-y-3 text-sm text-slate-netral",children:[t&&e.jsx(B,{variant:t.type==="success"?"success":"error",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.type==="success"?e.jsx(D,{className:"h-5 w-5",weight:"bold"}):e.jsx(q,{className:"h-5 w-5",weight:"bold"}),e.jsx("span",{children:t.message})]})}),e.jsxs("form",{className:"space-y-3",onSubmit:a.handleSubmit(s=>n.mutate(s)),children:[e.jsxs("label",{className:"flex flex-col gap-1",children:["Wilayah binaan",e.jsx("input",{className:"rounded-2xl border border-abu-kartu px-3 py-2",...a.register("wilayah"),placeholder:"Kelurahan / Desa"}),a.formState.errors.wilayah&&e.jsx("span",{className:"text-xs text-oranye-hangat",children:a.formState.errors.wilayah.message})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:["Jadwal panen",e.jsx("input",{type:"datetime-local",className:"rounded-2xl border border-abu-kartu px-3 py-2",...a.register("jadwal")}),a.formState.errors.jadwal&&e.jsx("span",{className:"text-xs text-oranye-hangat",children:a.formState.errors.jadwal.message})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:["Titik kumpul",e.jsx("input",{className:"rounded-2xl border border-abu-kartu px-3 py-2",...a.register("titikKumpul"),placeholder:"Balai desa / gudang"}),a.formState.errors.titikKumpul&&e.jsx("span",{className:"text-xs text-oranye-hangat",children:a.formState.errors.titikKumpul.message})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:["Estimasi peserta",e.jsx("input",{type:"number",min:1,className:"rounded-2xl border border-abu-kartu px-3 py-2",...a.register("estimasiPeserta",{valueAsNumber:!0})}),a.formState.errors.estimasiPeserta&&e.jsx("span",{className:"text-xs text-oranye-hangat",children:a.formState.errors.estimasiPeserta.message})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:["Kebutuhan personel",e.jsx("input",{type:"number",min:1,className:"rounded-2xl border border-abu-kartu px-3 py-2",...a.register("kebutuhanPersonel",{valueAsNumber:!0})}),a.formState.errors.kebutuhanPersonel&&e.jsx("span",{className:"text-xs text-oranye-hangat",children:a.formState.errors.kebutuhanPersonel.message})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:["Catatan tambahan",e.jsx("textarea",{className:"rounded-2xl border border-abu-kartu px-3 py-2",rows:3,...a.register("catatan"),placeholder:"Detail rute atau kebutuhan logistik"})]}),e.jsx(N,{type:"submit",className:"w-full",disabled:n.isPending,children:n.isPending?"Mengirim...":"Kirim permintaan"})]})]})]}),e.jsxs(c,{className:"bg-white",children:[e.jsxs(d,{children:[e.jsx(m,{children:"Riwayat permintaan"}),e.jsx(x,{children:"Catatan pengawalan yang sudah diajukan."})]}),e.jsx(p,{className:"space-y-2 text-xs text-slate-netral",children:o.length===0?e.jsx("p",{children:"Belum ada permintaan yang tercatat."}):o.map(s=>e.jsxs("div",{className:"rounded-2xl border border-abu-kartu p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-teks-gelap",children:s.wilayah}),e.jsx(E,{variant:b[s.status].variant,children:b[s.status].label})]}),e.jsxs("p",{children:["Jadwal: ",j(s.jadwal)]}),e.jsxs("p",{children:["Titik kumpul: ",s.titikKumpul]}),e.jsxs("p",{children:["Peserta: ",s.estimasiPeserta," orang"]}),e.jsxs("p",{children:["Personel diminta: ",s.kebutuhanPersonel]}),e.jsxs("p",{children:["Diajukan: ",j(s.diajukanAt)]}),e.jsxs("p",{children:["Oleh: ",s.diajukanOleh]}),s.catatan&&e.jsxs("p",{children:["Catatan: ",s.catatan]})]},s.id))})]})]})};export{I as default};
//# sourceMappingURL=escort-request-BTN9oqRf.js.map
