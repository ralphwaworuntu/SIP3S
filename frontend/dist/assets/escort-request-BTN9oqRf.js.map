{"version":3,"file":"escort-request-BTN9oqRf.js","sources":["../../src/pages/dashboard/bhabinkamtibmas/escort-request.tsx"],"sourcesContent":["import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { CheckCircle, WarningCircle } from \"@phosphor-icons/react\";\n\nimport { Alert } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useAuth } from \"@/context/auth-context\";\nimport { bhabinService } from \"@/services/bhabin-service\";\nimport type { EscortRequestPayload, EscortRequest } from \"@/types/bhabin\";\n\nconst escortSchema = z.object({\n  wilayah: z.string().min(2, \"Wajib diisi\"),\n  jadwal: z.string().min(1, \"Pilih jadwal\"),\n  titikKumpul: z.string().min(3, \"Wajib diisi\"),\n  estimasiPeserta: z.coerce.number().min(1, \"Minimal 1 orang\"),\n  kebutuhanPersonel: z.coerce.number().min(1, \"Minimal 1 personel\"),\n  catatan: z.string().optional(),\n});\n\ninterface FeedbackState {\n  type: \"success\" | \"error\";\n  message: string;\n}\n\nconst statusBadge: Record<EscortRequest[\"status\"], { label: string; variant: \"success\" | \"warning\" | \"neutral\" }> = {\n  baru: { label: \"Menunggu\", variant: \"warning\" },\n  dijadwalkan: { label: \"Dijadwalkan\", variant: \"neutral\" },\n  selesai: { label: \"Selesai\", variant: \"success\" },\n};\n\nconst formatDateTime = (iso: string) =>\n  new Date(iso).toLocaleString(\"id-ID\", { dateStyle: \"medium\", timeStyle: \"short\" });\n\nconst EscortRequestPage = () => {\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n  const [feedback, setFeedback] = useState<FeedbackState | null>(null);\n\n  const form = useForm<EscortRequestPayload>({\n    resolver: zodResolver(escortSchema),\n    defaultValues: {\n      wilayah: \"\",\n      jadwal: \"\",\n      titikKumpul: \"\",\n      estimasiPeserta: 20,\n      kebutuhanPersonel: 4,\n      catatan: \"\",\n    },\n  });\n\n  const escortQuery = useQuery({\n    queryKey: [\"bhabin\", \"escort\"],\n    queryFn: () => bhabinService.listEscortRequests(),\n  });\n\n  const escortMutation = useMutation({\n    mutationFn: (payload: EscortRequestPayload) =>\n      bhabinService.submitEscortRequest({ ...payload, diajukanOleh: user?.email ?? \"bhabin@polda.ntt.gov.id\" }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"bhabin\", \"escort\"] });\n      setFeedback({ type: \"success\", message: \"Permintaan pengawalan terkirim.\" });\n      form.reset({ wilayah: \"\", jadwal: \"\", titikKumpul: \"\", estimasiPeserta: 20, kebutuhanPersonel: 4, catatan: \"\" });\n    },\n    onError: () => setFeedback({ type: \"error\", message: \"Gagal mengirim permintaan. Coba ulangi.\" }),\n  });\n\n  const requests = escortQuery.data ?? [];\n\n  return (\n    <section className=\"grid gap-4 xl:grid-cols-[1fr_1fr]\">\n      <Card className=\"bg-white\">\n        <CardHeader>\n          <CardTitle>Permintaan pengawalan panen</CardTitle>\n          <CardDescription>Kirim jadwal kawalan ke Polres untuk dukungan personel.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-3 text-sm text-slate-netral\">\n          {feedback && (\n            <Alert variant={feedback.type === \"success\" ? \"success\" : \"error\"}>\n              <div className=\"flex items-center gap-2\">\n                {feedback.type === \"success\" ? (\n                  <CheckCircle className=\"h-5 w-5\" weight=\"bold\" />\n                ) : (\n                  <WarningCircle className=\"h-5 w-5\" weight=\"bold\" />\n                )}\n                <span>{feedback.message}</span>\n              </div>\n            </Alert>\n          )}\n\n          <form className=\"space-y-3\" onSubmit={form.handleSubmit((values) => escortMutation.mutate(values))}>\n            <label className=\"flex flex-col gap-1\">\n              Wilayah binaan\n              <input className=\"rounded-2xl border border-abu-kartu px-3 py-2\" {...form.register(\"wilayah\")} placeholder=\"Kelurahan / Desa\" />\n              {form.formState.errors.wilayah && (\n                <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.wilayah.message}</span>\n              )}\n            </label>\n            <label className=\"flex flex-col gap-1\">\n              Jadwal panen\n              <input type=\"datetime-local\" className=\"rounded-2xl border border-abu-kartu px-3 py-2\" {...form.register(\"jadwal\")} />\n              {form.formState.errors.jadwal && (\n                <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.jadwal.message}</span>\n              )}\n            </label>\n            <label className=\"flex flex-col gap-1\">\n              Titik kumpul\n              <input className=\"rounded-2xl border border-abu-kartu px-3 py-2\" {...form.register(\"titikKumpul\")} placeholder=\"Balai desa / gudang\" />\n              {form.formState.errors.titikKumpul && (\n                <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.titikKumpul.message}</span>\n              )}\n            </label>\n            <div className=\"grid gap-3 md:grid-cols-2\">\n              <label className=\"flex flex-col gap-1\">\n                Estimasi peserta\n                <input type=\"number\" min={1} className=\"rounded-2xl border border-abu-kartu px-3 py-2\" {...form.register(\"estimasiPeserta\", { valueAsNumber: true })} />\n                {form.formState.errors.estimasiPeserta && (\n                  <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.estimasiPeserta.message}</span>\n                )}\n              </label>\n              <label className=\"flex flex-col gap-1\">\n                Kebutuhan personel\n                <input type=\"number\" min={1} className=\"rounded-2xl border border-abu-kartu px-3 py-2\" {...form.register(\"kebutuhanPersonel\", { valueAsNumber: true })} />\n                {form.formState.errors.kebutuhanPersonel && (\n                  <span className=\"text-xs text-oranye-hangat\">{form.formState.errors.kebutuhanPersonel.message}</span>\n                )}\n              </label>\n            </div>\n            <label className=\"flex flex-col gap-1\">\n              Catatan tambahan\n              <textarea className=\"rounded-2xl border border-abu-kartu px-3 py-2\" rows={3} {...form.register(\"catatan\")} placeholder=\"Detail rute atau kebutuhan logistik\" />\n            </label>\n            <Button type=\"submit\" className=\"w-full\" disabled={escortMutation.isPending}>\n              {escortMutation.isPending ? \"Mengirim...\" : \"Kirim permintaan\"}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n\n      <Card className=\"bg-white\">\n        <CardHeader>\n          <CardTitle>Riwayat permintaan</CardTitle>\n          <CardDescription>Catatan pengawalan yang sudah diajukan.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-2 text-xs text-slate-netral\">\n          {requests.length === 0 ? (\n            <p>Belum ada permintaan yang tercatat.</p>\n          ) : (\n            requests.map((item) => (\n              <div key={item.id} className=\"rounded-2xl border border-abu-kartu p-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium text-teks-gelap\">{item.wilayah}</span>\n                  <Badge variant={statusBadge[item.status].variant}>{statusBadge[item.status].label}</Badge>\n                </div>\n                <p>Jadwal: {formatDateTime(item.jadwal)}</p>\n                <p>Titik kumpul: {item.titikKumpul}</p>\n                <p>Peserta: {item.estimasiPeserta} orang</p>\n                <p>Personel diminta: {item.kebutuhanPersonel}</p>\n                <p>Diajukan: {formatDateTime(item.diajukanAt)}</p>\n                <p>Oleh: {item.diajukanOleh}</p>\n                {item.catatan && <p>Catatan: {item.catatan}</p>}\n              </div>\n            ))\n          )}\n        </CardContent>\n      </Card>\n    </section>\n  );\n};\n\nexport default EscortRequestPage;\r\n"],"names":["escortSchema","z.object","z.string","z.coerce","statusBadge","formatDateTime","iso","EscortRequestPage","user","useAuth","queryClient","useQueryClient","feedback","setFeedback","useState","form","useForm","zodResolver","escortQuery","useQuery","bhabinService","escortMutation","useMutation","payload","requests","jsxs","Card","CardHeader","jsx","CardTitle","CardDescription","CardContent","Alert","CheckCircle","WarningCircle","values","Button","item","Badge"],"mappings":"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"}