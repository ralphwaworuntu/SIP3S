import{e as c,v as b}from"./index-CHgft2lY.js";import{f,g as k,h as p,i as g,j as w}from"./mock-data-CaIK6OKu.js";const n={recipients:"sip3s.bhabin.recipients",plant:"sip3s.bhabin.plant",harvest:"sip3s.bhabin.harvest",escort:"sip3s.bhabin.escort"},a=(h,t)=>{if(typeof window>"u")return t;try{const r=window.localStorage.getItem(h);return r?JSON.parse(r)??t:(window.localStorage.setItem(h,JSON.stringify(t)),t)}catch(r){return console.warn("Gagal membaca cache Bhabin",r),t}},u=(h,t)=>{if(!(typeof window>"u"))try{window.localStorage.setItem(h,JSON.stringify(t))}catch(r){console.warn("Gagal menyimpan cache Bhabin",r)}};class v{async listAssignments(t){if(!t)return[];try{const{data:r}=await c.get("/bhabin/assignments",{params:{email:t}});return r}catch{return f.filter(e=>e.bhabinEmail===t).map(e=>({id:e.id,bhabinEmail:e.bhabinEmail,wilayahId:e.wilayahId,wilayahName:e.wilayahName,kecamatan:e.kecamatan,desa:e.desa,pplEmail:e.pplEmail}))}}async listRecipients(){try{const{data:t}=await c.get("/bhabin/recipients");return t}catch{return a(n.recipients,k)}}async verifyRecipient(t){try{const{data:r}=await c.post("/bhabin/recipients/verify",t);return r}catch{const i=a(n.recipients,k).map(s=>s.id===t.id?{...s,status:"verified",verifiedAt:new Date().toISOString(),notes:t.notes,lokasi:t.lokasi,fotoEvidence:t.fotoEvidence,productType:t.productType,seedType:t.seedType,seedQuantityKg:t.seedQuantityKg,pupukNpkKg:t.pupukNpkKg,pupukUreaKg:t.pupukUreaKg}:s);return u(n.recipients,i),i.find(s=>s.id===t.id)??{...k[0],status:"verified",verifiedAt:new Date().toISOString(),notes:t.notes,lokasi:t.lokasi,fotoEvidence:t.fotoEvidence,productType:t.productType,seedType:t.seedType,seedQuantityKg:t.seedQuantityKg,pupukNpkKg:t.pupukNpkKg,pupukUreaKg:t.pupukUreaKg}}}async listPlantProgress(){try{const{data:t}=await c.get("/bhabin/plant-progress");return t}catch{return a(n.plant,g)}}async submitPlantProgress(t){try{const{data:r}=await c.post("/bhabin/plant-progress",t);return r}catch{const e={id:b(),wilayah:t.wilayah,petani:t.petani,komoditas:t.komoditas,fase:t.fase,kondisi:t.kondisi,catatan:t.catatan,updatedAt:new Date().toISOString(),lokasi:t.lokasi,fotoEvidence:t.fotoEvidence,pupukDigunakanKg:t.pupukDigunakanKg,luasLahanBersihM2:t.luasLahanBersihM2,bibitDitanamKg:t.bibitDitanamKg},i=[e,...a(n.plant,g)];return u(n.plant,i),e}}async listHarvestVerifications(){try{const{data:t}=await c.get("/bhabin/harvests");return t}catch{return a(n.harvest,w)}}async submitHarvestVerification(t){try{const{data:r}=await c.post("/bhabin/harvests",t);return r}catch{const e={id:b(),petani:t.petani,komoditas:t.komoditas,luasPanenHa:t.luasPanenHa,produksiTon:t.produksiTon,lokasi:t.lokasi,diverifikasiAt:new Date().toISOString(),keterangan:t.keterangan,koordinat:t.koordinat,fotoEvidence:t.fotoEvidence},i=[e,...a(n.harvest,w)];return u(n.harvest,i),e}}async listEscortRequests(){try{const{data:t}=await c.get("/bhabin/escorts");return t}catch{return a(n.escort,p)}}async submitEscortRequest(t){try{const{data:r}=await c.post("/bhabin/escorts",t),e=a(n.escort,p),i=[r,...e.filter(s=>s.id!==r.id)];return u(n.escort,i),r}catch{const e={id:b(),wilayah:t.wilayah,jadwal:t.jadwal,titikKumpul:t.titikKumpul,estimasiPeserta:t.estimasiPeserta,kebutuhanPersonel:t.kebutuhanPersonel,status:"baru",catatan:t.catatan,diajukanOleh:t.diajukanOleh,diajukanAt:new Date().toISOString()},i=[e,...a(n.escort,p)];return u(n.escort,i),e}}async updateEscortStatus(t,r){try{const{data:e}=await c.patch(`/bhabin/escorts/${t}`,{status:r}),i=a(n.escort,p),s=i.some(o=>o.id===e.id)?i.map(o=>o.id===e.id?e:o):[e,...i];return u(n.escort,s),e}catch{const i=a(n.escort,p),s=i.findIndex(d=>d.id===t);if(s===-1)return null;const o={...i[s],status:r},m=i.map(d=>d.id===t?o:d);return u(n.escort,m),o}}}const E=new v;export{E as b};
//# sourceMappingURL=bhabin-service-CDJ-XKa-.js.map
